<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>Liva | Personal blog template</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Hugo 0.92.2" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://demo.gethugothemes.com/liva/examplesite/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://demo.gethugothemes.com/liva/examplesite/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://demo.gethugothemes.com/liva/examplesite/"><img class="img-fluid"
          src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-instagram"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-github"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://demo.gethugothemes.com/liva/examplesite/"><img class="img-fluid"
            src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/about/">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/blog/">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/contact/">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://demo.gethugothemes.com/liva/examplesite//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/liva/examplesite/categories/portugues"
          class="text-primary">Portugues</a>
        
        <a href="/liva/examplesite/categories/ansible"
          class="text-primary">Ansible</a>
        
        <a href="/liva/examplesite/categories/qa"
          class="text-primary">Qa</a>
        
        <h2>Usando variáveis no Ansible</h2>
        <div class="mb-3 post-meta">
          <span>By Themefisher</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>22 February 2021</span>
          
        </div>
        
        <div class="content mb-5">
          <h1 id="introdução">Introdução</h1>
<p>O Ansible é uma ferramenta com muitas possibilidades e grande versatilidade, e justamente por isso pode ser um problema para quem usa suas funcionalidades sem seguir algumas boas práticas.</p>
<p>Esse artigo tem como objetivo apresentar as formas que eu aconselho na utilização de variáveis do Ansible. Eu vou tentar pontuar, da forma mais clara possível, os motivos para cada sugestão apresentada, mas percebam que boa parte delas partem de uma premissa de organização, e talvez não seja a sua forma de organizar.</p>
<h1 id="como-assim-usar-variáveis-no-ansible">Como assim usar variáveis no Ansible?</h1>
<p>Normalmente você utilizará variáveis em uma <em>role</em> Ansible por dois motivos:</p>
<ul>
<li>Mudar comportamento da <em>role</em></li>
<li>Evitar repetição de valores dentro da <em>role</em></li>
</ul>
<h2 id="mudar-comportamento-da-role">Mudar comportamento da <em>role</em></h2>
<p>Se você não sabe o que é uma <em>role</em> no Ansible, vale muito a pena ler <a href="https://gomex.me/2021/01/18/como-organizar-as-roles-e-playbooks-do-ansible/">esse</a> artigo.</p>
<p>Quando se constrói uma <em>role</em> Ansible normalmente se espera que ela assegure um conjunto de comportamentos, que normalmente são agrupados para fazer algum sentido.</p>
<p>Vamos usar como exemplo uma <em>role</em> para controlar o <a href="https://nginx.org/en/">nginx</a>. Essa <em>role</em> seria responsável por garantir que o pacote do nginx esteja instalado e um determinado conjunto de domínios seja configurado. Esses são os comportamentos esperados dessa <em>role</em>.</p>
<p>Como mudar o comportamento citado acima? Eu posso especificar qual versão do nginx será instalado, qual porta padrão será utilizada, quais plugins quero instalar no processo, localização da pasta de log e afins.</p>
<p>A possibilidade de modificar o comportamento de uma <em>role</em> sempre estará limitado a quantidade de variáveis que essa <em>role</em> tem, pois caso contrário você precisa mudar o código da <em>role</em> para que ela se comporte de uma outra forma.</p>
<p>Imagine a execução de um playbook como esse:</p>
<pre tabindex="0"><code>---
- hosts: all
  roles:
    - nginx
  vars:
    nginx_version: 1.19
</code></pre><p>Nessa <em>role</em> terá alguma task responsável por instalar o pacote e ele seria assim para uma plataforma que usa apt-get como instalador de pacotes:</p>
<pre tabindex="0"><code>- name: Instalando pacote
  apt:
    name: nginx={{ nginx_version }}
</code></pre><p>Com base nisso podemos concluir que o valor passado no <strong>nginx_version</strong> será usado no momento da instalação, isso quer dizer que se você esquecer de passar esse valor o Ansible quebrará.</p>
<p>Nesse momento você deve ser fazer uma pergunta muito importante ao criar variáveis para mudança de comportamento na <em>role</em>: &ldquo;Essa variável <strong>precisa mesmo</strong> ser informada pelo usuário? Existe algum valor que eu possa sugerir sem que isso afete a lógica da <em>role</em>?&rdquo;</p>
<p>Se você pode passar um valor padrão, <strong>SEMPRE</strong> passe, pois uma <em>role</em> que precisa de um lista enorme de valores para funcionar não é algo muito funcional, né?</p>
<p>Caso você possa passar um valor default, sempre faça isso na pasta <strong>default</strong>. Segue abaixo um exemplo:</p>
<pre tabindex="0"><code>---
nginx_enable: true
nginx_install: true
nginx_start: true
nginx_version: 1.18
</code></pre><p>Com esses valores dentro do main.yml da pasta default, indica que caso você não informe <strong>nginx_version</strong> o valor usado pela <em>role</em> para informar qual versão do nginx que será instalada é <strong>1.18</strong>.</p>
<h3 id="evite-usar-o-filtro-default">Evite usar o filtro default</h3>
<p>Existe <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html#providing-default-values">um filtro</a> no Ansible para manipular valores de variáveis dentro da task.</p>
<p>Esse filtro é usado dentro da definição de variável na task:</p>
<pre tabindex="0"><code>- name: Instalando pacote ansible
  apt:
    name: nginx={{ nginx_version | default('1.18') }}
</code></pre><p>Com essa definição, caso você não especifique a versão usando a variável <strong>nginx_version</strong> essa task instalará o nginx na versão <strong>1.18</strong>.</p>
<p>Qual problema há nesse tipo de uso? Falta de padrão e desorganização da sua <em>role</em>. Imagine uma <em>role</em> com diversos arquivos definindo tasks e os valores padrão espalhados por todos os arquivos. Se você precisar modificar o valor padrão? Como saber quais arquivos devem ser modificados?</p>
<p>Se você utilizar os arquivos da pasta default ficará mais claro, afinal esses arquivos tem um propósito único. O que não é o caso dos arquivos de tasks.</p>
<h3 id="tratando-variáveis-sem-valores-padrões">Tratando variáveis sem valores padrões</h3>
<p>Um exemplo de uma variável que precisa <strong>realmente</strong> ser informada pelo usuário: Uma <em>role</em> que é responsável por gerenciar entradas DNS em um serviço SaaS. Essa <em>role</em> pode garantir que determinadas entradas não estejam lá. Se eu quiser usar esse comportamento eu necessariamente precisarei informar <strong>qual</strong> a entrada deve ser removida. Existe alguma forma de sugerir um valor padrão na <em>role</em> nessa situação? Não. Sendo assim você não informará nenhum valor na pasta <strong>default</strong>.</p>
<p>Nesses casos usaremos o <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html">assert</a> do Ansible, para validar se a variável existe antes de continuar o uso dessa <em>role</em>:</p>
<pre tabindex="0"><code>- name: Checar se 'nome_variavel' está definida
    assert:
      that:
        - nome_variavel is defined
      msg: &quot;'nome_variavel' precisa ser definida&quot;
</code></pre><p>Com o código acima executado antes de qualquer outra tarefa poderemos garantir que a <em>role</em> só será usada caso você informe a variável necessária. Você evita que a sua role seja executada pela metade e pare de funcionar antes de terminar todo processo. Deixando seu servidor com metade do que deveria ser assegurado na máquina.</p>
<h2 id="evitar-repetição-de-valores-dentro-da-role">Evitar repetição de valores dentro da role</h2>
<p>Dentro de uma <em>role</em> podem existir valores que você pode precisar repetir, mas você quer criar uma <em>role</em> bem parametrizada e evitar que uma mudança no nome do produto não demande que você busque em todo código o nome para que ele seja trocado um a um.</p>
<pre tabindex="0"><code>- name: Instalando pacote
  apt:
    name: {{ nome_produto }} ={{ versao_produto }}
- name: Garantir que o serviço está executando
  ansible.builtin.service:
    name: {{ nome_produto }}
    state: started
</code></pre><p>O valor de <strong>nome_produto</strong> deve ser armazenado na pasta <strong>vars</strong> dentro do arquivo main.yml:</p>
<pre tabindex="0"><code>---
nome_produto:  nginx
</code></pre><p>Lembre-se que o valor de <strong>versao_produto</strong> deve ser armazenado dentro da pasta <strong>default</strong>, pois esse é o comportamento que se espera que seja modificado pelo usuário. O valor da pasta <strong>vars</strong> é apenas para variáveis que não devem ser sobrescritas pelo usuário da <em>role</em>.</p>
<p>É importante entender a <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#understanding-variable-precedence">precedência</a> das variáveis quando elas são sobrescritas.</p>
<h1 id="conclusão">Conclusão</h1>
<p>Variáveis são formas interessantes de tornar sua <em>role</em> Ansible mais configurável e assim garantir uma boa manutenção desse código.</p>
<p>Sempre imagine que sua <em>role</em> vai crescer o suficiente para que seja necessário o uso de boas práticas, por isso aconselho sempre que começar já faça do jeito ideal, afinal depois de pronta, a refatoração pode ser mais trabalhosa.</p>
<h1 id="fontes">Fontes</h1>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html</a></li>
</ul>
<h1 id="agradecimentos">Agradecimentos</h1>
<p>Obrigado a <a href="https://twitter.com/somatorio">somatorio</a> que sempre revisa tudo que escrevo.</p>
<p>Obrigado também a lista de pessoas abaixo que também revisaram o texto:</p>
<ul>
<li><a href="https://br.linkedin.com/in/klebercabral">Kleber Cabral</a></li>
<li><a href="https://twitter.com/riverfount">Prof. Dr. Vicente Marçal</a></li>
<li><a href="https://www.linkedin.com/in/">Francílio Araújo</a></li>
</ul>

        </div>

        
        
      </div>
    </div>
  </div>
</section>


<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2>Join Our Newsletter</h2>
        <p class="text-light px-md-5 py-4 border-left border-right border-primary">
          Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero</p>
        <form action="#" class="row justify-content-center">
          <div class="input-group col-md-8">
            <input type="text" class="form-control" placeholder="Your Email Address">
            <div class="input-group-append">
              <button class="input-group-text btn btn-primary">Subscribe</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>


<footer class="text-capitalize">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://demo.gethugothemes.com/liva/examplesite/"><img src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0124857985320"><i
                class="ti-mobile mr-3 text-primary"></i>0124857985320</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Dhaka, Bangladedsh</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:demo@email.com"><i
                class="ti-email mr-3 text-primary"></i>demo@email.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="#">facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">instagram</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/ansible/">Ansible</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/blog/">Blog</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/carreira/">Carreira</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/devops/">Devops</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/devopsdays/">Devopsdays</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/dicas/">Dicas</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/docker/">Docker</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/english/">English</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/herois/">Herois</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/iac/">Iac</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/mac/">MAC</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/mentoria/">Mentoria</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/node/">Node</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/pipeline/">Pipeline</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/portugues/">Portugues</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/qa/">Qa</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/remoto/">Remoto</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/ruby/">Ruby</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/scratch/">Scratch</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/supervisord/">Supervisord</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/about/">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/blog/">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/contact/">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="https://themefisher.com/hugo-themes/">Themefisher</a> All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://demo.gethugothemes.com/liva/examplesite/index.json"
</script>

<!-- JS Plugins -->

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/jQuery/jquery.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/slick/slick.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/venobox/venobox.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/fuse.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/mark.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://demo.gethugothemes.com/liva/examplesite/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>