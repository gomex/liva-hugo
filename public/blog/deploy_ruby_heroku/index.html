<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>Liva | Personal blog template</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Hugo 0.92.2" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://demo.gethugothemes.com/liva/examplesite/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://demo.gethugothemes.com/liva/examplesite/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://demo.gethugothemes.com/liva/examplesite/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://demo.gethugothemes.com/liva/examplesite/"><img class="img-fluid"
          src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-instagram"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-github"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://demo.gethugothemes.com/liva/examplesite/"><img class="img-fluid"
            src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/about/">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/blog/">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://demo.gethugothemes.com/liva/examplesite/contact/">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://demo.gethugothemes.com/liva/examplesite//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/liva/examplesite/categories/english"
          class="text-primary">English</a>
        
        <a href="/liva/examplesite/categories/devops"
          class="text-primary">Devops</a>
        
        <a href="/liva/examplesite/categories/docker"
          class="text-primary">Docker</a>
        
        <a href="/liva/examplesite/categories/ruby"
          class="text-primary">Ruby</a>
        
        <a href="/liva/examplesite/categories/node"
          class="text-primary">Node</a>
        
        <h2>How to deploy Ruby and Node app on Heroku using Docker - Part 1</h2>
        <div class="mb-3 post-meta">
          <span>By Themefisher</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>15 February 2019</span>
          
        </div>
        
        <div class="content mb-5">
          <h2 id="tldr">TL;DR</h2>
<p>We needed to deploy a ruby+node application as a docker image on Heroku, but I didn&rsquo;t use Heroku cli to build it.  This document is about how we did the development, test, build, tag and deployment of a docker image on a Heroku application according to the best practices.</p>
<p>I will split this article into some parts. In this &ldquo;Part 1&rdquo; I will explain in details how I delivered the first version of a Dockerfile, without Multistage build,  to create the docker image and Docker compose file to bring up the whole development environment.</p>
<h2 id="attention">Attention</h2>
<p>If you copy and paste some codes shown here without reading the context, it may not work properly on your environment.</p>
<p>I will present the code, tell the story behind this phase and show how I improved it after seeing the problem.</p>
<h2 id="setup">Setup</h2>
<p>To reproduce this article, you need to install these tools:</p>
<ul>
<li>Docker</li>
<li>Docker compose</li>
<li>Make</li>
</ul>
<h2 id="the-environments">The environments</h2>
<p>We have three environments:</p>
<ul>
<li>Development: It is only on the developer&rsquo;s machine.</li>
<li>Staging: It is for QA analysis on Heroku app</li>
<li>Production: It is the real app running on Heroku app</li>
</ul>
<h2 id="dockerization-for-developers-first">Dockerization for developers first</h2>
<p>I started this job providing docker environment to developers and getting feedbacks.</p>
<p>Here is my Dockerfile to developers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ruby:2.5.1 as builder</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -sL https://deb.nodesource.com/setup_8.x | bash - <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    echo <span style="color:#e6db74">&#34;deb https://dl.yarnpkg.com/debian/ stable main&#34;</span> | tee /etc/apt/sources.list.d/yarn.list<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> apt-get install -y locales <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        graphviz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        imagemagick <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        postgresql-client-9.6 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        yarn <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        nodejs <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;en_US.UTF-8 UTF-8&#34;</span> &gt; /etc/locale.gen <span style="color:#f92672">&amp;&amp;</span> /usr/sbin/locale-gen <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> GEM_HOME /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> GEM_SPEC_CACHE /gems/specs<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_APP_CONFIG /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_PATH /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_BIN /gems/vendor/bin<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> PATH /app/bin:/gems/vendor/bin:$PATH<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> RAILS_ENV<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> RAILS_ENV<span style="color:#f92672">=</span>$RAILS_ENV<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> APP_ROOT /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> $APP_ROOT/</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p /gems<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> groupadd -r app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> groupmod -g <span style="color:#ae81ff">1000</span> app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> useradd -g app -ms /bin/bash app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> chown app $APP_ROOT <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#f92672">&amp;&amp;</span> chown app /gems<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> app</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> Gemfile.lock $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> Gemfile $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package-lock.json $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package.json $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> bundle install<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> yarn install<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;bundle&#34;</span>,<span style="color:#e6db74">&#34;exec&#34;</span>,<span style="color:#e6db74">&#34;rails&#34;</span>,<span style="color:#e6db74">&#34;server&#34;</span>,<span style="color:#e6db74">&#34;-b&#34;</span>,<span style="color:#e6db74">&#34;0.0.0.0&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>This Dockerfile is responsible for setting up everything that we needed to start the development job.</p>
<p>We didn&rsquo;t need to copy the code to docker context on the docker image creation phase. We mounted the source code inside the container on runtime:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t ruby_node_app:0.1 .
docker run -it --build-arg RAILS_ENV<span style="color:#f92672">=</span>development -v $PWD:/app ruby_node_app:0.1
</code></pre></div><p>The <strong>RAILS_ENV</strong> variable was used to change the gem installation behavior — some gems we didn&rsquo;t need to install in production.</p>
<h3 id="dockefile-explained">Dockefile, explained</h3>
<p>We used this first section to set up the basis of this dev environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ruby:2.5.1 as builder</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -sL https://deb.nodesource.com/setup_8.x | bash - <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    echo <span style="color:#e6db74">&#34;deb https://dl.yarnpkg.com/debian/ stable main&#34;</span> | tee /etc/apt/sources.list.d/yarn.list<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> apt-get install -y locales <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        graphviz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        imagemagick <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        postgresql-client-9.6 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        yarn <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        nodejs <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;en_US.UTF-8 UTF-8&#34;</span> &gt; /etc/locale.gen <span style="color:#f92672">&amp;&amp;</span> /usr/sbin/locale-gen <span style="color:#f92672">&amp;&amp;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>We needed to use a specific folder of gems. We mounted this folder on runtime. It was a dev requirement to troubleshoot gem usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">ENV</span> GEM_HOME /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> GEM_SPEC_CACHE /gems/specs<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_APP_CONFIG /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_PATH /gems/vendor<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> BUNDLE_BIN /gems/vendor/bin<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>We needed to specify the app folder and create the app user to use root instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">ENV</span> APP_ROOT /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> $APP_ROOT/</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p /gems<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> groupadd -r app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> groupmod -g <span style="color:#ae81ff">1000</span> app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> useradd -g app -ms /bin/bash app <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> chown app $APP_ROOT <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#f92672">&amp;&amp;</span> chown app /gems<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> app</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>We needed to install all ruby and node requirements:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">COPY</span> Gemfile.lock $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> Gemfile $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package-lock.json $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package.json $APP_ROOT/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> bundle install<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> yarn install<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>In the end, we needed to specify the exposed port and default command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;bundle&#34;</span>,<span style="color:#e6db74">&#34;exec&#34;</span>,<span style="color:#e6db74">&#34;rails&#34;</span>,<span style="color:#e6db74">&#34;server&#34;</span>,<span style="color:#e6db74">&#34;-b&#34;</span>,<span style="color:#e6db74">&#34;0.0.0.0&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h2 id="adding-docker-compose">Adding docker-compose</h2>
<p>We needed to use some external resources (i.e., DB), to that, Docker-compose was used on this setup.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.4&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">onboarding_app</span>:
    <span style="color:#f92672">working_dir</span>: <span style="color:#ae81ff">/app</span>
    <span style="color:#f92672">build</span>:
      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">.</span>
      <span style="color:#f92672">args</span>:
        <span style="color:#f92672">RAILS_ENV</span>: <span style="color:#ae81ff">development</span>
    <span style="color:#f92672">env_file</span>:
      - <span style="color:#ae81ff">./.env</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">.:/app</span>
      - <span style="color:#ae81ff">./tmp/gems:/gems</span>
      - <span style="color:#ae81ff">onboarding_app_home:/home/app/</span>
      - <span style="color:#ae81ff">.irbrc:/home/app/.irbrc</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">3010</span>:<span style="color:#ae81ff">3000</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#ae81ff">mailcatcher</span>
      - <span style="color:#ae81ff">postgres</span>
      - <span style="color:#ae81ff">redis</span>
  <span style="color:#f92672">mailcatcher</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">schickling/mailcatcher</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">1080</span>:<span style="color:#ae81ff">1080</span>
  <span style="color:#f92672">postgres</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:9.6-alpine</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">5432</span>:<span style="color:#ae81ff">5432</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">postgres:/var/lib/postgresql/data</span>
  <span style="color:#f92672">redis</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:4.0.6-alpine</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">redis:/data</span>
<span style="color:#f92672">volumes</span>:
  <span style="color:#f92672">gems_2_5_1</span>:
  <span style="color:#f92672">postgres</span>:
  <span style="color:#f92672">redis</span>:
  <span style="color:#f92672">onboarding_app_home</span>:
</code></pre></div><p>Run this command to bring up this environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose up --build
</code></pre></div><h3 id="docker-compose-file-explained">Docker-compose file, explained</h3>
<p>We needed to send the RAILS_ENV argument to build process of docker image. This RAILS_ENV variable was used to install all the gems related to development environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">build</span>:
      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">.</span>
      <span style="color:#f92672">args</span>:
        <span style="color:#f92672">RAILS_ENV</span>: <span style="color:#ae81ff">development</span>
</code></pre></div><p>We needed to inform the environment variable to be used on docker container execution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    <span style="color:#f92672">env_file</span>:
      - <span style="color:#ae81ff">./.env</span>
</code></pre></div><p>We mounted some folders to help coding and troubleshooting. I will explain one by one.</p>
<p>First, we needed to mount the source code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">.:/app</span>
</code></pre></div><p>We needed to mount the folder used inside the docker image to add gems. This mounted folder is necessary to troubleshoot gem usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">      - <span style="color:#ae81ff">./tmp/gems:/gems</span>
</code></pre></div><p>We needed to persist some config of app user so that we mounted the home folder of app user and .irbrc file too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">      - <span style="color:#ae81ff">onboarding_app_home:/home/app/</span>
      - <span style="color:#ae81ff">.irbrc:/home/app/.irbrc</span>
</code></pre></div><p>To finish this service, we needed to publish the port used to connect on the application and inform which services it depends on:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">3010</span>:<span style="color:#ae81ff">3000</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#ae81ff">mailcatcher</span>
      - <span style="color:#ae81ff">postgres</span>
      - <span style="color:#ae81ff">redis</span>
</code></pre></div><p>These services are being used to provide external resources to app service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">mailcatcher</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">schickling/mailcatcher</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">1080</span>:<span style="color:#ae81ff">1080</span>
  <span style="color:#f92672">postgres</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:9.6-alpine</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">5432</span>:<span style="color:#ae81ff">5432</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">postgres:/var/lib/postgresql/data</span>
  <span style="color:#f92672">redis</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:4.0.6-alpine</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">redis:/data</span>
</code></pre></div><p>Here we added the volumes used inside this docker-compose file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">volumes</span>:
  <span style="color:#f92672">gems_2_5_1</span>:
  <span style="color:#f92672">postgres</span>:
  <span style="color:#f92672">redis</span>:
  <span style="color:#f92672">onboarding_app_home</span>:
</code></pre></div><h2 id="to-be-continued">To be continued&hellip;</h2>
<h2 id="thanks">Thanks</h2>
<p>My co-workers at <a href="http://paycertify.com">Paycertify</a> who helped me giving me feedbacks and options to fix the problems, I need to say a special thanks to Rafael Affonso who enabled me to correct some mistakes about my English.</p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>


<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2>Join Our Newsletter</h2>
        <p class="text-light px-md-5 py-4 border-left border-right border-primary">
          Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero</p>
        <form action="#" class="row justify-content-center">
          <div class="input-group col-md-8">
            <input type="text" class="form-control" placeholder="Your Email Address">
            <div class="input-group-append">
              <button class="input-group-text btn btn-primary">Subscribe</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>


<footer class="text-capitalize">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://demo.gethugothemes.com/liva/examplesite/"><img src="https://demo.gethugothemes.com/liva/examplesite/images/logo.png" alt="Liva | Personal blog template"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0124857985320"><i
                class="ti-mobile mr-3 text-primary"></i>0124857985320</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Dhaka, Bangladedsh</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:demo@email.com"><i
                class="ti-email mr-3 text-primary"></i>demo@email.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="#">facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">instagram</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="#">linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/ansible/">Ansible</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/blog/">Blog</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/carreira/">Carreira</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/devops/">Devops</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/devopsdays/">Devopsdays</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/dicas/">Dicas</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/docker/">Docker</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/english/">English</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/herois/">Herois</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/iac/">Iac</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/mac/">MAC</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/mentoria/">Mentoria</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/node/">Node</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/pipeline/">Pipeline</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/portugues/">Portugues</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/qa/">Qa</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/remoto/">Remoto</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/ruby/">Ruby</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/scratch/">Scratch</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/liva/examplesite/categories/supervisord/">Supervisord</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/about/">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/blog/">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://demo.gethugothemes.com/liva/examplesite/contact/">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="https://themefisher.com/hugo-themes/">Themefisher</a> All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://demo.gethugothemes.com/liva/examplesite/index.json"
</script>

<!-- JS Plugins -->

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/jQuery/jquery.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/slick/slick.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/venobox/venobox.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/fuse.min.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/mark.js"></script>

<script src="https://demo.gethugothemes.com/liva/examplesite/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://demo.gethugothemes.com/liva/examplesite/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>